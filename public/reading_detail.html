<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Detay</title>
  <style>
    /* Temel stiller */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .card h1, .card h2 {
      margin-top: 0;
      color: #333;
    }
    
    button {
      background: #6c757d;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
    }
    
    button:hover {
      background: #5a6268;
    }
    
    .small {
      color: #666;
      font-size: 14px;
      margin-top: 10px;
    }
    
    /* Monospace alanlar iÃ§in stiller */
    .mono {
      font-family: 'Courier New', Courier, monospace;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      line-height: 1.6;
      font-size: 14px;
      
      /* CRITICAL: Uzun metinlerin taÅŸmasÄ±nÄ± Ã¶nle */
      word-wrap: break-word;
      word-break: break-word;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      max-width: 100%;
    }
    
    /* Renkli karÅŸÄ±laÅŸtÄ±rma stilleri */
    #diff {
      line-height: 2;
      font-size: 16px;
    }
    
    /* Kelime renk kodlamasÄ± */
    .word-correct, .w.ok {
      background: #d4edda;
      color: #155724;
      padding: 2px 4px;
      border-radius: 4px;
      margin: 0 2px;
      border: 1px solid #c3e6cb;
      display: inline-block;
    }
    
    .word-error, .w.sub {
      background: #f8d7da;
      color: #721c24;
      padding: 2px 4px;
      border-radius: 4px;
      margin: 0 2px;
      text-decoration: line-through;
      border: 1px solid #f5c6cb;
      display: inline-block;
    }
    
    .word-missing, .w.del {
      background: #fff3cd;
      color: #856404;
      padding: 2px 4px;
      border-radius: 4px;
      margin: 0 2px;
      border: 1px solid #ffeaa7;
      font-style: italic;
      text-decoration: line-through;
      display: inline-block;
    }
    
    .word-extra, .w.ins {
      background: #d1ecf1;
      color: #0c5460;
      padding: 2px 4px;
      border-radius: 4px;
      margin: 0 2px;
      border: 1px solid #b6d7e2;
      font-weight: bold;
      display: inline-block;
    }
    
    /* Eski stil sÄ±nÄ±flarÄ± iÃ§in uyumluluk */
    .diff .w {
      padding: 2px 6px;
      margin: 2px;
      border-radius: 6px;
      display: inline-block;
    }
    
    .diff .ok {
      background: rgba(22,163,74,0.12);
      border: 1px solid rgba(22,163,74,0.22);
      color: #15803d;
    }
    
    .diff .sub {
      background: rgba(245,158,11,0.12);
      border: 1px solid rgba(245,158,11,0.22);
      color: #d97706;
    }
    
    .diff .del {
      background: rgba(239,68,68,0.08);
      border: 1px solid rgba(239,68,68,0.16);
      text-decoration: line-through;
      color: #dc2626;
    }
    
    .diff .ins {
      background: rgba(14,165,164,0.08);
      border: 1px solid rgba(14,165,164,0.16);
      color: #0891b2;
      font-weight: bold;
    }
    
    /* Hata raporu kutusu */
    .error-summary {
      background: #fff3cd;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      border-left: 4px solid #ffc107;
      font-size: 14px;
    }
    
    .error-summary strong {
      color: #856404;
    }
    
    /* Responsive tasarÄ±m */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .card {
        padding: 15px;
      }
      
      .mono {
        font-size: 12px;
        padding: 15px;
      }
      
      #diff {
        font-size: 14px;
      }
    }
    
    /* Scroll bar stilleri */
    .mono::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .mono::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    .mono::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    
    .mono::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Loading state */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .error {
      text-align: center;
      padding: 40px;
      color: #dc3545;
      background: #f8d7da;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ“Š Okuma DetayÄ±</h1>
      <a href="teacher.html">
        <button>â† Ã–ÄŸretmen Paneline DÃ¶n</button>
      </a>
    </div>

    <div class="card">
      <h2>ğŸ¨ Renkli KarÅŸÄ±laÅŸtÄ±rma</h2>
      <div id="diff" class="mono">
        <div class="loading">Veriler yÃ¼kleniyor...</div>
      </div>
      <div class="small">
        <strong>Renk AÃ§Ä±klamasÄ±:</strong><br>
        <span class="word-correct">YeÅŸil: DoÄŸru kelime</span> â€¢ 
        <span class="word-error">KÄ±rmÄ±zÄ± Ã§izgili: YanlÄ±ÅŸ kelime</span> â€¢ 
        <span class="word-missing">SarÄ± italik: Atlanan kelime</span> â€¢ 
        <span class="word-extra">Mavi kalÄ±n: Fazla kelime</span>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ“– Referans Metin (Orijinal)</h2>
      <div id="ref" class="mono">
        <div class="loading">Veriler yÃ¼kleniyor...</div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ™ï¸ Ã–ÄŸrenci OkumasÄ± (Transcript)</h2>
      <div id="hyp" class="mono">
        <div class="loading">Veriler yÃ¼kleniyor...</div>
      </div>
    </div>
  </div>

  <script>
    async function load() {
      try {
        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        
        if (!id) {
          showError('Okuma ID\'si bulunamadÄ±. URL\'de ?id=123 parametresi olmalÄ±.');
          return;
        }
        
        // Loading state gÃ¶ster
        document.getElementById('diff').innerHTML = '<div class="loading">ğŸ“Š KarÅŸÄ±laÅŸtÄ±rma analizi yÃ¼kleniyor...</div>';
        document.getElementById('ref').innerHTML = '<div class="loading">ğŸ“– Orijinal metin yÃ¼kleniyor...</div>';
        document.getElementById('hyp').innerHTML = '<div class="loading">ğŸ™ï¸ Ã–ÄŸrenci okumasÄ± yÃ¼kleniyor...</div>';
        
        const response = await fetch('/api/reading/' + id + '/detail');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (!data) {
          throw new Error('Veri bulunamadÄ±');
        }
        
        // Renkli karÅŸÄ±laÅŸtÄ±rmayÄ± gÃ¶ster
        const diffElement = document.getElementById('diff');
        if (data.detail_html && data.detail_html.trim()) {
          diffElement.innerHTML = data.detail_html;
        } else {
          // EÄŸer detail_html yoksa, basit karÅŸÄ±laÅŸtÄ±rma yap
          diffElement.innerHTML = '<div class="error">âš ï¸ Renkli karÅŸÄ±laÅŸtÄ±rma verisi bulunamadÄ±. Bu okuma eski sistemde yapÄ±lmÄ±ÅŸ olabilir.</div>';
        }
        
        // Orijinal metni gÃ¶ster
        const refElement = document.getElementById('ref');
        if (data.ref_text || data.content) {
          refElement.textContent = data.ref_text || data.content || 'Metin bulunamadÄ±';
        } else {
          refElement.innerHTML = '<div class="error">âŒ Referans metin bulunamadÄ±</div>';
        }
        
        // Ã–ÄŸrenci okumasÄ±nÄ± gÃ¶ster
        const hypElement = document.getElementById('hyp');
        if (data.transcript && data.transcript.trim()) {
          hypElement.textContent = data.transcript;
        } else {
          hypElement.innerHTML = '<div class="error">âŒ Ã–ÄŸrenci okumasÄ± bulunamadÄ± veya boÅŸ</div>';
        }
        
        // Sayfa baÅŸlÄ±ÄŸÄ±nÄ± gÃ¼ncelle
        if (data.title) {
          document.title = `${data.title} - Okuma DetayÄ±`;
        }
        
      } catch (error) {
        console.error('Veri yÃ¼kleme hatasÄ±:', error);
        showError('Veriler yÃ¼klenirken hata oluÅŸtu: ' + error.message);
      }
    }
    
    function showError(message) {
      const errorHtml = `<div class="error">âŒ ${message}</div>`;
      document.getElementById('diff').innerHTML = errorHtml;
      document.getElementById('ref').innerHTML = errorHtml;
      document.getElementById('hyp').innerHTML = errorHtml;
    }
    
    // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
    document.addEventListener('DOMContentLoaded', load);
    
    // Hata durumunda sayfa yenileme Ã¶zelliÄŸi
    window.addEventListener('error', function(e) {
      console.error('Sayfa hatasÄ±:', e.error);
    });
    
    // Network hatalarÄ±nÄ± yakala
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Promise hatasÄ±:', e.reason);
    });
  </script>
</body>
</html>